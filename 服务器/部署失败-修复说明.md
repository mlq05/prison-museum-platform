# 部署失败修复说明

## 错误信息

```
Error: Cannot find module './collections'
Require stack:
- /app/db/database.js
- /app/server.js
```

## 问题原因

`collections.js` 文件没有被提交到 GitHub，导致 Docker 构建时找不到该文件。

## 解决方案

### 步骤 1：检查文件是否存在

确保以下文件都在 `服务器/db/` 目录下：
- ✅ `database.js`
- ✅ `collections.js` (这个文件可能还没有提交到 Git)
- ✅ `database-schema.md`
- ✅ `README.md`

### 步骤 2：提交所有修改的文件

在 Git Bash 中执行：

```bash
cd /f/test4

# 检查 collections.js 是否存在
ls 服务器/db/collections.js

# 添加所有修改的文件
git add 服务器/db/collections.js
git add 服务器/db/database.js
git add 服务器/routes/booking.js
git add 服务器/routes/feedback.js
git add 服务器/数据库错误排查指南.md

# 提交
git commit -m "修复：添加数据库集合服务层，更新路由使用云数据库API"

# 推送到 GitHub
git push origin main
```

### 步骤 3：重新部署

代码推送到 GitHub 后，CloudBase 会自动重新部署。等待部署完成即可。

## 验证

部署完成后，检查服务器日志，应该看到：
- ✅ 云数据库初始化成功
- ✅ 服务器启动成功
- ❌ 不应该再看到 "Cannot find module './collections'" 错误

## 如果问题仍然存在

1. 确认 `collections.js` 文件已经提交到 GitHub（在 GitHub 网页上查看）
2. 确认 Dockerfile 中的 `COPY . .` 命令会复制所有文件
3. 检查 `.dockerignore` 是否排除了 `collections.js`（应该没有）

