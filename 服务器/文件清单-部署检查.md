# 📋 服务器文件部署检查清单

## ✅ 必须上传的文件

### 核心文件
- ✅ `server.js` - 服务器入口文件（必需）
- ✅ `package.json` - 依赖配置（必需）
- ✅ `package-lock.json` - 锁定版本（推荐）
- ✅ `Dockerfile` - Docker配置（必需）
- ✅ `.dockerignore` - Docker忽略文件（推荐）

### 配置文件
- ✅ `cloudbaserc.json` - 云开发配置
- ⚠️ `.cloudbaserc.json` - 云开发配置（与上面重复，可选）

### 代码目录
- ✅ `db/` - 数据库模块（必需）
  - ✅ `database.js` - 数据库初始化
- ✅ `routes/` - 路由模块（必需）
  - ✅ `admin.js` - 管理员路由
  - ✅ `ar.js` - AR相关路由
  - ✅ `booking.js` - 预约路由
  - ✅ `certificate.js` - 证书路由
  - ✅ `collection.js` - 收藏路由
  - ✅ `feedback.js` - 反馈路由
  - ✅ `game.js` - 游戏路由
  - ✅ `hall.js` - 展区路由
  - ✅ `user.js` - 用户路由
- ✅ `middleware/` - 中间件（必需）
  - ✅ `auth.js` - 认证中间件
  - ✅ `errorHandler.js` - 错误处理
  - ✅ `logger.js` - 日志中间件
- ✅ `scripts/` - 脚本（可选，但推荐）
  - ✅ `init-db.js` - 数据库初始化脚本

## ❌ 不需要上传的文件

### 自动生成/安装的
- ❌ `node_modules/` - 依赖包（云托管会自动安装）
- ❌ `data/` - 数据目录（云托管会在 /tmp/data 创建）
- ❌ `uploads/` - 上传目录（云托管会在 /tmp/uploads 创建）

### 本地开发/部署脚本
- ❌ `.gitignore` - Git配置（不需要）
- ❌ `deploy.bat` / `deploy.sh` - 部署脚本（仅本地使用）
- ❌ `打包.bat` / `打包.sh` - 打包脚本（仅本地使用）
- ❌ `server.zip` - 打包产物（不需要）

## 📦 AR页面代码位置

**重要说明**：AR页面代码**不在服务器目录**，需要单独部署！

### AR页面位置
```
miniprogram/ar-pages/
├── marker-ar-simple.html     ✅ AR页面主文件
└── libs/                     ✅ AR库文件目录
    ├── aframe-ar.js          ✅ AR.js库
    ├── aframe.min.js         ✅ A-Frame库
    ├── camera_para.dat       ✅ 相机参数文件
    └── hiro.patt             ✅ Hiro marker模式文件
```

### 部署方式
AR页面需要部署到**静态网站托管**（不是云托管）：
1. 登录云开发控制台
2. 进入"静态网站托管"
3. 上传 `miniprogram/ar-pages/` 目录下的所有文件
4. 获取访问地址

## ✅ 打包脚本检查

打包脚本 `打包.bat` 已经正确配置，会自动：
- ✅ 包含所有必需文件
- ✅ 排除 `node_modules/`
- ✅ 排除 `data/` 和 `uploads/`
- ✅ 排除所有 `.md` 文档文件

## 📝 部署检查清单

### 服务器代码（云托管）
- [ ] 已确认所有必需文件存在
- [ ] 已运行打包脚本（或使用 CLI 部署）
- [ ] 已确认 Dockerfile 存在
- [ ] 已确认 package.json 配置正确
- [ ] 已排除不需要的文件

### AR页面（静态网站托管）
- [ ] 已确认 AR 页面文件在 `miniprogram/ar-pages/` 目录
- [ ] 已上传到静态网站托管
- [ ] 已获取访问地址
- [ ] 已测试 AR 页面访问

## 🔍 配置文件检查

### cloudbaserc.json vs .cloudbaserc.json
- `cloudbaserc.json` 和 `.cloudbaserc.json` 内容基本相同
- 两个文件都包含环境ID：`prison-museum-dev-8e6hujc6eb768b`
- 建议：只保留一个即可（推荐使用 `cloudbaserc.json`）

## ⚠️ 重要提示

1. **AR代码不在服务器目录**：AR页面是静态HTML文件，需要部署到静态网站托管，不是云托管
2. **数据持久化**：云托管使用临时存储，重启后数据会丢失，建议使用云数据库
3. **环境变量**：必须在云开发控制台配置 `NODE_ENV` 和 `JWT_SECRET`

