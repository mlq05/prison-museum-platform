# 🚀 数据库部署 - 快速开始

## ⚡ 3步快速部署

### 第1步：配置环境变量

在云开发控制台配置以下环境变量：

1. 登录 [云开发控制台](https://console.cloud.tencent.com/tcb)
2. 选择环境：`prison-museum-dev-8e6hujc6eb768b`
3. 进入 **"云托管" → "服务管理" → "museum-api" → "环境变量"**
4. 添加环境变量：

```
TCB_ENV=prison-museum-dev-8e6hujc6eb768b
TCB_SECRET_ID=你的SecretId
TCB_SECRET_KEY=你的SecretKey
```

**如何获取 SecretId 和 SecretKey**：
- 访问：https://console.cloud.tencent.com/cam/capi
- 创建或查看密钥
- 复制 `SecretId` 和 `SecretKey`

---

### 第2步：创建数据库集合（可选）

集合会在首次使用时自动创建，但提前创建可以配置索引：

1. 进入 **"数据库" → "数据集合"**
2. 点击 **"新建集合"**，创建以下集合：
   - `users`
   - `admins`
   - `bookings`
   - `halls`
   - `feedbacks`
   - `collections`
   - `certificates`
   - `visit_settings`
   - `ar_checkins`

---

### 第3步：重新部署服务器

环境变量配置后，需要重新部署服务器：

1. 在云开发控制台进入 **"云托管" → "服务管理" → "museum-api"**
2. 点击 **"重新部署"** 或 **"部署新版本"**
3. 等待部署完成（约2-5分钟）

---

## ✅ 验证部署

部署完成后，查看服务器日志，应该看到：

```
云数据库初始化成功，环境ID: prison-museum-dev-8e6hujc6eb768b
开始初始化云数据库集合...
默认管理员账号已创建: zysfjgxy / 123456
云数据库集合初始化完成
```

---

## 📚 详细文档

完整的部署文档请参考：`数据库部署指南.md`

---

## 🔧 常见问题

**Q: 如何知道环境变量配置成功？**
A: 查看服务器日志，如果看到"云数据库初始化成功"，说明配置正确。

**Q: 集合必须手动创建吗？**
A: 不是必须的，集合会在首次使用时自动创建。但提前创建可以配置索引提高性能。

**Q: 数据库初始化失败怎么办？**
A: 检查环境变量是否正确配置，特别是 SecretId 和 SecretKey 是否正确。

