# 🚨 立即修复问题 - 操作步骤

## 📋 问题诊断

**500错误的根本原因**：数据库集合不存在！

你的代码使用的是**文档型数据库（NoSQL）**，但集合还没有创建。

## ✅ 修复步骤（按顺序执行）

### 步骤 1：登录 CloudBase 控制台

1. 打开浏览器，访问：https://console.cloud.tencent.com/tcb
2. 登录你的腾讯云账号
3. 选择环境：`prison-museum-dev-8e6hujc6eb768b`

---

### 步骤 2：找到文档型数据库

**重要**：不要在 MySQL 数据库中操作！

在左侧导航栏中找到：

```
📊 数据库
  └─ 📁 数据集合  ← 点击这个！
```

或者：

```
📊 Database
  └─ 📁 Collections  ← 点击这个！
```

**如果找不到**：
- 尝试点击 "数据库" 展开子菜单
- 或在顶部搜索框输入："数据集合" 或 "Collections"

---

### 步骤 3：创建必需的集合

**至少创建这3个集合**（这是最紧急的）：

#### 3.1 创建 `bookings` 集合（预约信息）

1. 点击页面上的 **"新建集合"** 或 **"+ 添加集合"** 按钮
2. 在弹出的对话框中：
   - **集合名称**：输入 `bookings`（全部小写）
   - 点击 **"确定"** 或 **"创建"**
3. 等待创建完成，`bookings` 会出现在集合列表中

#### 3.2 创建 `feedbacks` 集合（反馈信息）

重复上面的步骤：
- 集合名称：`feedbacks`
- 点击创建

#### 3.3 创建 `users` 集合（用户信息）

重复上面的步骤：
- 集合名称：`users`
- 点击创建

---

### 步骤 4：验证集合创建成功

创建完成后，你应该能在集合列表中看到：

- ✅ bookings
- ✅ feedbacks
- ✅ users

---

### 步骤 5：测试功能

集合创建后，立即测试小程序：

1. **测试创建预约**：
   - 在小程序中填写预约表单
   - 提交预约
   - 应该能成功，不再出现500错误

2. **测试查看预约列表**：
   - 打开"我的预约"
   - 应该能看到刚才创建的预约记录

3. **测试提交反馈**：
   - 在小程序中提交反馈
   - 应该能成功

---

## 🎯 如果还有问题

### 如果仍然出现500错误

1. **检查服务器日志**：
   - 在 CloudBase 控制台进入：**"云托管" → "服务管理" → "museum-api" → "日志"**
   - 查看最新的错误日志
   - 如果看到"集合不存在"的错误，说明集合创建有问题

2. **确认集合名称**：
   - 集合名称必须完全匹配（区分大小写）
   - `bookings` 不是 `Bookings` 或 `BOOKINGS`

3. **确认环境变量**：
   - 检查环境变量是否已配置：
     - `TCB_ENV=prison-museum-dev-8e6hujc6eb768b`
     - `TCB_SECRET_ID=你的SecretId`
     - `TCB_SECRET_KEY=你的SecretKey`
   - 路径：**"云托管" → "服务管理" → "museum-api" → "环境变量"**

---

## 📝 可选的额外集合

如果需要完整功能，可以创建其他集合（不是紧急的）：

4. `admins` - 管理员信息
5. `halls` - 展区信息
6. `collections` - 收藏信息
7. `certificates` - 证书信息
8. `visit_settings` - 时段设置
9. `ar_checkins` - AR打卡

这些可以在主要功能修复后再创建。

---

## ✅ 修复完成检查清单

- [ ] 已登录 CloudBase 控制台
- [ ] 已找到"数据集合"页面（不是MySQL）
- [ ] 已创建 `bookings` 集合
- [ ] 已创建 `feedbacks` 集合
- [ ] 已创建 `users` 集合
- [ ] 已在集合列表中验证看到这3个集合
- [ ] 已测试创建预约（成功）
- [ ] 已测试查看预约列表（成功）
- [ ] 已测试提交反馈（成功）

---

## 💡 重要提示

1. **不需要重新部署服务器** - 集合创建后立即生效
2. **集合名称必须完全匹配** - `bookings`（小写，复数）
3. **如果找不到"数据集合"** - 可能需要刷新页面或检查环境选择

---

## 🆘 需要帮助？

如果遇到问题，请提供：
1. CloudBase 控制台左侧导航栏的截图
2. 创建集合时出现的任何错误消息
3. 服务器日志中的错误信息

