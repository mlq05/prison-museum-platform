# 📋 查看服务日志 - 操作步骤

## ✅ 当前发现

- ✅ 实例状态：**Running**（运行中）
- ✅ 实例名称：`museum-api-009-97c86dfc7-5pfzq`
- ✅ 创建时间：`2025-12-07 17:24:45`（刚刚创建，可能刚重启）

**问题**：实例运行中，但小程序返回 503 错误。

可能原因：
1. 服务刚重启，还在初始化中
2. 服务启动但数据库连接失败
3. 服务启动但端口监听有问题
4. 健康检查失败

## ✅ 下一步：查看日志

### 步骤 1：关闭实例列表对话框

点击 **"取消"** 按钮，关闭实例列表对话框。

---

### 步骤 2：进入日志页面

在服务详情页面：

1. **找到并点击 "日志" 标签**
2. **设置日志时间范围**：
   - 选择 **"最近 1 小时"** 或 **"最近 24 小时"**
   - 或者选择从 `2025-12-07 17:24:45`（实例创建时间）开始

---

### 步骤 3：查找关键日志信息

在日志中查找以下内容：

#### 3.1 服务器启动日志

查找是否有以下日志：

```
╔═══════════════════════════════════════════════════════════╗
║  中国监狱历史文化展览馆智慧预约平台 - 云托管服务器          ║
║  服务器已启动: 端口 80                                    ║
```

**如果看到这个**：说明服务器成功启动。

**如果没看到**：说明服务器启动失败。

---

#### 3.2 数据库初始化日志

查找是否有以下日志：

**成功的情况**：
```
✅ 云数据库初始化成功
   环境ID: prison-museum-dev-8e6hujc6eb768b
   SecretId: AKIDYEwZ...
```

**失败的情况**：
```
❌ 数据库初始化失败：缺少必要的环境变量
   请检查以下环境变量是否已配置：
   - TCB_ENV
   - TCB_SECRET_ID
   - TCB_SECRET_KEY
```

或

```
❌ 云数据库初始化失败: [错误信息]
```

---

#### 3.3 错误日志

查找以下类型的错误：

- `Error: Cannot find module`
- `TypeError:`
- `ReferenceError:`
- `数据库未初始化`
- `500 Internal Server Error`

---

### 步骤 4：分析日志结果

#### 情况 A：服务器启动成功，数据库初始化成功

**如果看到**：
- ✅ 服务器已启动
- ✅ 数据库初始化成功

**但仍然 503**，可能原因：
1. 健康检查路径配置错误
2. 服务刚启动，Nginx 还没检测到
3. 等待 1-2 分钟再测试

**解决方法**：
- 等待 2-3 分钟
- 重新测试小程序

---

#### 情况 B：服务器启动成功，但数据库初始化失败

**如果看到**：
- ✅ 服务器已启动
- ❌ 数据库初始化失败

**这是问题所在！**

**解决方法**：
1. 检查环境变量配置
2. 确保 `TCB_SECRET_ID` 和 `TCB_SECRET_KEY` 已设置
3. 重新部署服务

---

#### 情况 C：服务器启动失败

**如果看到**：
- ❌ 没有"服务器已启动"的日志
- ❌ 有 `Error:` 或 `Cannot find module` 错误

**这是问题所在！**

**解决方法**：
- 查看错误详情
- 可能需要修复代码或配置

---

#### 情况 D：没有任何启动日志

**如果看不到任何日志**：
- 可能日志还没刷新
- 或者日志时间范围不对

**解决方法**：
- 调整日志时间范围
- 点击刷新按钮

---

## 🎯 现在需要你做的

1. **关闭实例列表对话框**（点击"取消"）
2. **进入"日志"标签**
3. **查看最近的日志**，特别是：
   - 是否有"服务器已启动"的消息？
   - 是否有"数据库初始化成功"或失败的消息？
   - 是否有任何错误信息？
4. **复制或截图日志**，特别是错误信息

## 📝 请告诉我

查看日志后，请告诉我：

1. **是否看到"服务器已启动"的日志？**
2. **是否看到"数据库初始化成功"或失败的消息？**
3. **是否有任何错误信息？**（如果有，请复制完整的错误信息）
4. **最新的日志时间是什么时候？**

根据这些信息，我可以帮你准确诊断问题并修复！

