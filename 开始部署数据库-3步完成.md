# 🚀 开始部署数据库 - 3步完成

## 📋 概述

数据库功能代码已经全部完成，现在只需要在云开发控制台配置环境变量即可使用！

---

## ⚡ 第1步：获取腾讯云密钥（5分钟）

1. 访问：https://console.cloud.tencent.com/cam/capi
2. 登录腾讯云账号
3. 如果没有API密钥，点击 **"新建密钥"**
4. 复制以下信息：
   - `SecretId` - API密钥ID
   - `SecretKey` - API密钥Key（⚠️ 只在创建时显示一次，请立即保存！）

---

## ⚡ 第2步：配置环境变量（3分钟）

1. 登录：https://console.cloud.tencent.com/tcb
2. 选择环境：`prison-museum-dev-8e6hujc6eb768b`
3. 进入：**"云托管" → "服务管理" → "museum-api" → "环境变量"**
4. 点击 **"新增环境变量"**，添加以下3个变量：

   **变量1**：
   - 变量名：`TCB_ENV`
   - 变量值：`prison-museum-dev-8e6hujc6eb768b`

   **变量2**：
   - 变量名：`TCB_SECRET_ID`
   - 变量值：`你的SecretId`（从第1步获取）

   **变量3**：
   - 变量名：`TCB_SECRET_KEY`
   - 变量值：`你的SecretKey`（从第1步获取）

5. 点击 **"保存"**

---

## ⚡ 第3步：重新部署服务器（3分钟）

环境变量配置后，必须重新部署服务器才能生效：

1. 在同一页面，点击 **"重新部署"** 按钮
   - 或者返回服务列表，点击 **"部署新版本"**
2. 如果使用Git仓库部署：
   - 分支：`main`
   - 构建目录：`服务器`
3. 点击 **"开始部署"**
4. 等待部署完成（约2-5分钟）

---

## ✅ 验证部署成功

部署完成后：

### 1. 查看服务器日志

- 路径：**"云托管" → "服务管理" → "museum-api" → "日志"**
- 应该看到：
  ```
  云数据库初始化成功，环境ID: prison-museum-dev-8e6hujc6eb768b
  开始初始化云数据库集合...
  默认管理员账号已创建: zysfjgxy / 123456
  云数据库集合初始化完成
  ```

### 2. 测试健康检查

访问：
```
https://museum-api-205770-6-1390408503.sh.run.tcloudbase.com/health
```

应该返回：
```json
{
  "success": true,
  "message": "服务器运行正常",
  "timestamp": "2025-12-07T..."
}
```

---

## 📝 可选操作

### 创建数据库集合（可选）

集合会在首次使用时自动创建，但可以提前创建以便配置索引：

1. 进入：**"数据库" → "数据集合"**
2. 点击 **"新建集合"**，创建以下集合：
   - `users` - 用户账号信息
   - `admins` - 管理员信息
   - `bookings` - 预约信息
   - `halls` - 展区信息
   - `feedbacks` - 反馈信息
   - `collections` - 收藏信息
   - `certificates` - 证书信息
   - `visit_settings` - 参观设置
   - `ar_checkins` - AR打卡记录

---

## 🎯 部署完成后

数据库部署完成后，所有数据操作都会真正保存到云数据库：

- ✅ **用户账号信息** - 永久保存
- ✅ **管理员信息** - 永久保存
- ✅ **预约记录** - 预约成功后可以查询到
- ✅ **展区信息** - 永久保存
- ✅ **用户反馈** - 永久保存
- ✅ **所有其他数据** - 永久保存

---

## 📚 详细文档

- 完整部署指南：`数据库部署指南.md`
- 操作清单：`数据库部署-操作清单.md`
- 快速开始：`立即执行-数据库部署.md`

---

## 🆘 常见问题

**Q: 环境变量在哪里配置？**
A: 云开发控制台 → 云托管 → 服务管理 → museum-api → 环境变量

**Q: SecretId 和 SecretKey 在哪里获取？**
A: https://console.cloud.tencent.com/cam/capi

**Q: 配置环境变量后需要重新部署吗？**
A: 是的，必须重新部署服务器才能生效。

**Q: 集合需要手动创建吗？**
A: 不是必须的，集合会在首次使用时自动创建。

---

## 🎉 开始部署

按照上述3个步骤操作，数据库就能正常使用了！

部署完成后告诉我，我们可以测试数据库功能！

