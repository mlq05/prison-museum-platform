# 📦 账号密码登录功能部署说明

## ⚠️ 当前问题

控制台显示 `POST /api/user/login-account` 返回 404，说明新路由还未部署成功。

## ✅ 解决方案：重新打包并部署

### 步骤1：确认代码已更新

已确认以下新路由已在 `服务器/routes/user.js` 中：
- ✅ `POST /api/user/register` - 用户注册
- ✅ `POST /api/user/login-account` - 账号密码登录  
- ✅ `GET /api/user/check-username` - 检查用户名

### 步骤2：重新打包代码

在 `服务器` 目录下运行：

```powershell
cd 服务器
.\打包.bat
```

这将生成 `server.zip` 文件（当前文件大小：64273 bytes）

### 步骤3：在云控制台上传部署

1. **打开云开发控制台**
   - 访问：https://console.cloud.tencent.com/tcb
   - 选择环境：`prison-museum-dev-8e6hujc6eb768b`
   - 进入：**"云托管" → "服务管理" → "museum-api"**

2. **部署新版本**
   - 点击 **"部署版本"** 标签
   - 点击 **"新建版本"** 或 **"部署新版本"**
   - 选择 **"本地上传"**
   - 上传文件：`F:\test4\服务器\server.zip`

3. **配置环境变量**（如果还没配置）
   ```
   TCB_ENV = prison-museum-dev-8e6hujc6eb768b
   TCB_SECRET_ID = 你的密钥ID
   TCB_SECRET_KEY = 你的密钥Key
   ```

4. **开始部署**
   - 点击 **"开始部署"**
   - 等待 2-5 分钟

### 步骤4：验证部署成功

部署完成后，测试接口：

**测试检查用户名接口：**
```
GET https://museum-api-205770-6-1390408503.sh.run.tcloudbase.com/api/user/check-username?username=test123
```

**测试登录接口：**
```
POST https://museum-api-205770-6-1390408503.sh.run.tcloudbase.com/api/user/login-account
Content-Type: application/json

{
  "username": "test",
  "password": "123456"
}
```

### 步骤5：在小程序中测试

1. 重新编译小程序
2. 进入登录/注册页面
3. 输入用户名，应该不再出现 404 错误
4. 尝试注册或登录

## 🔍 故障排查

如果部署后仍然 404：

1. **检查部署日志**
   - 在控制台 **"日志"** 标签查看是否有错误
   - 确认服务状态为 **"正常"**

2. **确认路由文件包含新代码**
   - 检查 `服务器/routes/user.js` 是否包含：
     - `router.post('/register'` (约第169行)
     - `router.post('/login-account'` (约第296行)
     - `router.get('/check-username'` (约第395行)

3. **确认模块导出**
   - 文件末尾应该有 `module.exports = router;`

4. **重新打包**
   - 删除旧的 `server.zip`
   - 重新运行 `打包.bat`
   - 重新上传部署

## 📝 其他修复

同时修复了以下问题：

1. ✅ **CSS 警告修复** - 移除了 Skyline 不支持的 `:focus` 伪类和属性选择器
2. ✅ **登录状态判断修复** - "我的"页面现在能正确显示登录状态

部署完成后，所有功能应该可以正常使用！

