<!--admin-open-days.wxml - 开放日设置页面-->
<view class="admin-open-days-page">
  <navigation-bar title="开放日设置" />

  <view class="container">
    <!-- 操作按钮 -->
    <view class="actions">
      <button class="btn btn-primary" bindtap="onInitDefault">初始化默认开放日（周五、六）</button>
      <button class="btn btn-secondary" bindtap="showAddModal">添加开放日</button>
    </view>

    <!-- 开放日列表 -->
    <view class="open-days-list">
      <view class="list-header">
        <text class="header-title">当前开放日设置</text>
      </view>

      <view class="list-content" wx:if="{{!loading && openDays.length > 0}}">
        <view class="open-day-item" wx:for="{{openDays}}" wx:key="_id">
          <view class="item-content">
            <view class="item-type">
              <text class="type-badge">{{item.type === 'weekday' ? '每周' : '具体日期'}}</text>
            </view>
            <view class="item-info">
              <text class="item-value">{{item.displayText}}</text>
              <text class="item-description" wx:if="{{item.description}}">{{item.description}}</text>
            </view>
          </view>
          <view class="item-actions">
            <button class="btn-delete" data-id="{{item._id}}" bindtap="onDelete">删除</button>
          </view>
        </view>
      </view>

      <view class="empty-state" wx:if="{{!loading && openDays.length === 0}}">
        <text class="empty-text">暂无开放日设置</text>
        <text class="empty-hint">点击"初始化默认开放日"或"添加开放日"开始设置</text>
      </view>

      <view class="loading-state" wx:if="{{loading}}">
        <text>加载中...</text>
      </view>
    </view>
  </view>

  <!-- 添加弹窗 -->
  <view class="modal" wx:if="{{showAddModal}}" bindtap="hideAddModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">添加开放日</text>
        <text class="modal-close" bindtap="hideAddModal">×</text>
      </view>

      <view class="modal-body">
        <!-- 类型选择 -->
        <view class="form-item">
          <text class="form-label">类型</text>
          <radio-group class="radio-group" bindchange="onTypeChange">
            <label class="radio-item">
              <radio value="weekday" checked="{{addForm.type === 'weekday'}}" />每周固定星期几
            </label>
            <label class="radio-item">
              <radio value="date" checked="{{addForm.type === 'date'}}" />具体日期
            </label>
          </radio-group>
        </view>

        <!-- 星期几选择 -->
        <view class="form-item" wx:if="{{addForm.type === 'weekday'}}">
          <text class="form-label">选择星期几</text>
          <picker
            mode="selector"
            range="{{weekdayOptions}}"
            range-key="label"
            value="{{addForm.weekday}}"
            bindchange="onWeekdayChange"
          >
            <view class="picker-view">
              <text>{{weekdayOptions[addForm.weekday].label}}</text>
              <text class="picker-arrow">></text>
            </view>
          </picker>
        </view>

        <!-- 日期选择 -->
        <view class="form-item" wx:if="{{addForm.type === 'date'}}">
          <text class="form-label">选择日期</text>
          <picker mode="date" value="{{addForm.date}}" bindchange="onDateChange">
            <view class="picker-view">
              <text>{{addForm.date || '请选择日期'}}</text>
              <text class="picker-arrow">></text>
            </view>
          </picker>
        </view>

        <!-- 描述 -->
        <view class="form-item">
          <text class="form-label">描述（可选）</text>
          <input
            class="form-input"
            placeholder="请输入描述"
            value="{{addForm.description}}"
            bindinput="onDescriptionInput"
          />
        </view>
      </view>

      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="hideAddModal">取消</button>
        <button class="btn btn-primary" bindtap="onSubmitAdd">确定</button>
      </view>
    </view>
  </view>
</view>

