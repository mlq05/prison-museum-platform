<!--admin-annual-report.wxml-->
<view class="annual-report-page">
  <navigation-bar title="å¹´åº¦æŠ¥å‘Š" />
  <scroll-view class="report-scroll" scroll-y="true" enable-back-to-top="true">
    <!-- å¹´ä»½é€‰æ‹© -->
    <view class="card">
      <view class="card-title">é€‰æ‹©å¹´ä»½</view>
      <picker mode="date" value="{{selectedYear}}" fields="year" bindchange="onYearChange">
        <view class="year-picker">{{selectedYear}}å¹´</view>
      </picker>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading-container">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- æŠ¥å‘Šå†…å®¹ -->
    <block wx:if="{{!loading && reportData}}">
      <!-- æ€»ä½“ç»Ÿè®¡ -->
      <view class="card">
        <view class="card-title">å¹´åº¦æ€»ä½“ç»Ÿè®¡</view>
        <view class="stats-grid">
          <view class="stat-item">
            <view class="stat-value">{{reportData.totalBookings}}</view>
            <view class="stat-label">æ€»é¢„çº¦æ•°</view>
          </view>
          <view class="stat-item">
            <view class="stat-value stat-success">{{reportData.approvedBookings}}</view>
            <view class="stat-label">å·²é€šè¿‡</view>
          </view>
          <view class="stat-item">
            <view class="stat-value stat-primary">{{reportData.totalVisitors}}</view>
            <view class="stat-label">æ€»æ¥è®¿äººæ•°</view>
          </view>
          <view class="stat-item">
            <view class="stat-value stat-primary">{{reportData.approvedVisitors}}</view>
            <view class="stat-label">å·²é€šè¿‡äººæ•°</view>
          </view>
        </view>
      </view>

      <!-- é¢†å¯¼æ¥è®¿ç»Ÿè®¡ -->
      <view class="card leader-card">
        <view class="card-title leader-title">
          <text>é¢†å¯¼æ¥è®¿ç»Ÿè®¡</text>
        </view>
        <view class="leader-stats">
          <view class="leader-stat-item">
            <view class="leader-value">{{reportData.leaderVisitCount}}</view>
            <view class="leader-label">é¢†å¯¼æ¥è®¿æ¬¡æ•°</view>
          </view>
          <view class="leader-stat-item">
            <view class="leader-value">{{reportData.leaderVisitVisitors}}</view>
            <view class="leader-label">é¢†å¯¼æ¥è®¿äººæ•°</view>
          </view>
        </view>
        
        <!-- é¢†å¯¼æ¥è®¿è¯¦æƒ… -->
        <view wx:if="{{reportData.leaderVisits.length > 0}}" class="leader-visits">
          <view class="section-subtitle">é¢†å¯¼æ¥è®¿è®°å½•</view>
          <view class="leader-visit-list">
            <view class="leader-visit-item" wx:for="{{reportData.leaderVisits}}" wx:key="_id">
              <view class="visit-header">
                <text class="visit-name">{{item.userName}}</text>
                <text class="visit-date">{{item.bookingDate}}</text>
              </view>
              <view class="visit-info">
                <text class="visit-count">æ¥è®¿äººæ•°ï¼š{{item.visitorCount}}äºº</text>
                <text class="visit-status" wx:if="{{item.status === 'approved'}}">å·²é€šè¿‡</text>
              </view>
              <view class="visit-remark" wx:if="{{item.remark}}">
                <text>{{item.remark}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- å¤‡æ³¨é«˜é¢‘è¯ -->
      <view class="card">
        <view class="card-title">å¤‡æ³¨é«˜é¢‘è¯ï¼ˆTop 20ï¼‰</view>
        <view wx:if="{{reportData.topWords.length > 0}}" class="words-list">
          <view class="word-item" wx:for="{{reportData.topWords}}" wx:key="word">
            <text class="word-text">{{item.word}}</text>
            <text class="word-count">{{item.count}}æ¬¡</text>
          </view>
        </view>
        <view wx:else class="empty-text">è¯¥å¹´åº¦æ— å¤‡æ³¨æ•°æ®</view>
      </view>

      <!-- è§’è‰²åˆ†å¸ƒ -->
      <view class="card">
        <view class="card-title">è§’è‰²åˆ†å¸ƒ</view>
        <view class="role-list">
          <view class="role-item">
            <view class="role-info">
              <text class="role-icon">ğŸ“</text>
              <text class="role-name">å­¦ç”Ÿ</text>
            </view>
            <view class="role-count">{{reportData.roleDistribution.student}}</view>
          </view>
          <view class="role-item">
            <view class="role-info">
              <text class="role-icon">ğŸ‘”</text>
              <text class="role-name">æ•™èŒå·¥</text>
            </view>
            <view class="role-count">{{reportData.roleDistribution.faculty}}</view>
          </view>
          <view class="role-item">
            <view class="role-info">
              <text class="role-icon">ğŸ‘¤</text>
              <text class="role-name">è®¿å®¢</text>
            </view>
            <view class="role-count">{{reportData.roleDistribution.visitor}}</view>
          </view>
        </view>
      </view>

      <!-- æœˆåº¦ç»Ÿè®¡ -->
      <view class="card">
        <view class="card-title">æœˆåº¦ç»Ÿè®¡</view>
        <view class="monthly-stats">
          <view class="month-item" wx:for="{{reportData.monthlyStats}}" wx:key="month">
            <view class="month-header">
              <text class="month-name">{{item.month}}æœˆ</text>
            </view>
            <view class="month-data">
              <view class="month-label">é¢„çº¦ï¼š{{item.bookings}}æ¬¡</view>
              <view class="month-label">äººæ•°ï¼š{{item.visitors}}äºº</view>
              <view class="month-label leader-label" wx:if="{{item.leaderVisits > 0}}">
                é¢†å¯¼æ¥è®¿ï¼š{{item.leaderVisits}}æ¬¡
              </view>
            </view>
          </view>
        </view>
      </view>
    </block>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{!loading && !reportData}}" class="empty-state">
      <text class="empty-text">æš‚æ— æ•°æ®</text>
    </view>
  </scroll-view>
</view>

